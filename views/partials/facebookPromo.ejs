<% if (!enlistedInFb) { %>
<!-- Facebook groups promo – styled like job item; overflow-anchor:none prevents scroll jump when it enters viewport -->
<div class="fb-promo-block w-full mx-auto px-4 mt-6 mb-4" style="overflow-anchor: none" data-fb-promo>
  <article class="relative flex items-center justify-center flex-col mx-auto my-4 mt-0 rounded-lg p-6 bg-primary text-white text-sm w-full">
    <button type="button" class="fb-promo-dismiss absolute top-2 right-2 w-8 h-8 rounded-full flex items-center justify-center text-white hover:bg-white/20 transition-colors cursor-pointer text-[30px] leading-none z-10" aria-label="დახურვა">×</button>
    <p class="text-[14px] text-white font-[400] mb-4">გაწევრიანდით ჩვენს Facebook ჯგუფში და გაიგეთ ყველაზე მაგარი ვაკანსიების შესახებ პირველმა!</p>
    <div class="flex flex-col sm:flex-row flex-wrap gap-3">
      <a href="/api/enlist-fb" target="_blank" rel="noopener noreferrer" class="fb-promo-enlist-link flex items-center justify-center gap-2 text-white hover:opacity-90 text-[14px]">
        <button type="button" class="bg-white w-full max-w-[296px] w-full h-[52px] text-primary block rounded-lg mb-1 text-[16px] mx-auto cursor-pointer px-2">
          <span>გაწევრიანება</span>
        </button>
      </a>
    </div>
  </article>
</div>
<script>
(function() {
  var key = 'enlisted_fb';
  function hidePromos() {
    try { document.querySelectorAll('[data-fb-promo]').forEach(function(el) { el.style.display = 'none'; }); } catch (e) {}
  }
  function saveAndHide() {
    try { localStorage.setItem(key, '1'); } catch (e) {}
    hidePromos();
  }
  if (typeof localStorage !== 'undefined' && localStorage.getItem(key)) {
    hidePromos();
    return;
  }
  document.addEventListener('DOMContentLoaded', function() {
    if (localStorage.getItem(key)) { hidePromos(); return; }
    document.querySelectorAll('.fb-promo-enlist-link').forEach(function(link) {
      link.addEventListener('click', function() {
        saveAndHide();
      });
    });
    document.querySelectorAll('.fb-promo-dismiss').forEach(function(btn) {
      btn.addEventListener('click', function() {
        fetch('/api/dismiss-fb-promo', { method: 'GET', credentials: 'same-origin' }).then(function() { saveAndHide(); }).catch(function() { saveAndHide(); });
      });
    });
  });
})();
</script>
<% } %>
