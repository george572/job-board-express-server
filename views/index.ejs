<!DOCTYPE html>
<html lang="ka">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <%- include('partials/head-meta', { seo }) %>
  <!-- WebSite schema for sitelinks / knowledge panel -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Samushao.ge",
      "url": "https://samushao.ge",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://samushao.ge/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
  </script>
  <!-- BreadcrumbList: მთავარი > ვაკანსიები -->
  <script type="application/ld+json">
    {"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"მთავარი","item":"https://samushao.ge/"},{"@type":"ListItem","position":2,"name":"ვაკანსიები","item":"<%= (seo && seo.canonical) ? seo.canonical : 'https://samushao.ge/' %>"}]}
  </script>
  <link rel="stylesheet" href="/css/style.css" />
  <script>
    if ('scrollRestoration' in history) history.scrollRestoration = 'manual';
    const SCROLL_KEY = 'scrollPos';
    const PAGE_KEY = 'currentPage';
  </script>
  <% if (currentPage > 1) { %>
  <link rel="prev" href="https://samushao.ge/<%= currentPage === 2 ? '' : '?page=' + (currentPage - 1) %>">
  <% } %>
  <% if (currentPage < totalPages) { %>
  <link rel="next" href="https://samushao.ge/?page=<%= currentPage + 1 %>">
  <% } %>
</head>

<body class="font-markgeo text-secondary bg-[#F8F9FA]">
  <%- include('partials/header') %>
  <%- include('partials/filters') %>

  <!-- Top CV-fit jobs (ვაკანსიები სადაც შენი CV ზუსტად ერგება) – at top, slider, hidden when any filter is active -->
  <% if (typeof topCvFitJobs !== 'undefined' && topCvFitJobs && topCvFitJobs.length > 0) { %>
  <section id="top-cv-fit-slider-section" class="w-full mx-auto px-4 mt-6 mb-4" style="<%= filtersActive ? 'display:none' : '' %>">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
      <div class="flex flex-col gap-1 flex-1">
        <h2 class="font-kolkha text-[18px] sm:text-[22px] text-[#151515]">
          ვაკანსიები სადაც შენი CV ერგება
        </h2>
        <% if (typeof topCvFitTotalCount !== 'undefined' && topCvFitTotalCount > 0) { %>
        <a id="top-cv-fit-see-all-link" href="/vakansiebi-shentvis" class="text-sm text-[#315EFF] hover:underline hidden sm:inline-block">
          ყველას ნახვა (<%= topCvFitTotalCount %>)
        </a>
        <% } %>
      </div>
      <div class="flex items-center justify-between sm:justify-end gap-2 flex-shrink-0">
        <% if (typeof topCvFitTotalCount !== 'undefined' && topCvFitTotalCount > 0) { %>
        <a id="top-cv-fit-see-all-link-mobile" href="/vakansiebi-shentvis" class="text-sm text-[#315EFF] hover:underline sm:hidden">
          ყველას ნახვა (<%= topCvFitTotalCount %>)
        </a>
        <% } %>
        <div class="flex items-center gap-2">
          <button type="button" class="top-cv-fit-prev w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Prev">←</button>
          <button type="button" class="top-cv-fit-next w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Next">→</button>
        </div>
      </div>
    </div>
    <div id="top-cv-fit-scroll" class="top-cv-fit-scroll flex w-full items-stretch gap-3 sm:gap-4 overflow-x-auto pb-4 pr-4 snap-x snap-mandatory" 
    style="scrollbar-width: none; -ms-overflow-style: none; -webkit-overflow-scrolling: touch;">
    <% topCvFitJobs.forEach(job => { %>
   <div class="top-cv-fit-card flex flex-shrink-0 max-w-[300px] md:max-w-[400px] w-full snap-start flex-col [&>article]:flex-1 [&>article]:flex [&>article]:flex-col<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' premium-job-mobile-first' : '' %>"<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' data-premium="true"' : '' %>>
     <%- include('partials/jobItemCompact.ejs', { job, slugify, inSlider: true, fromTopCvFit: true }) %>
   </div>
 <% }) %>
</div>
  </section>
  <% } %>

  <!-- Recommended jobs (personalized – only when we have results) -->
  <% if (typeof recommendedJobs !== 'undefined' && recommendedJobs && recommendedJobs.length > 0) { %>
  <section id="recommended-jobs-section" class="w-full mx-auto px-4 mt-6 mb-4">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
      <div class="flex flex-col gap-1 flex-1">
        <h2 class="font-kolkha text-[18px] sm:text-[22px] text-[#151515]">
          მსგავს ვაკანსიებს ხშირად სტუმრობ
        </h2>
        <a id="recommended-see-all-link" href="/rekomendebuli-vakansiebi" class="text-sm text-[#315EFF] hover:underline">
          ყველას ნახვა
        </a>
      </div>
      <div class="flex items-center gap-2">
        <button type="button" class="recommended-prev w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Prev">←</button>
        <button type="button" class="recommended-next w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Next">→</button>
      </div>
    </div>
    <div id="recommended-scroll" class="recommended-scroll flex w-full items-stretch gap-3 sm:gap-4 overflow-x-auto pb-4 pr-4 snap-x snap-mandatory" 
    style="scrollbar-width: none; -ms-overflow-style: none; -webkit-overflow-scrolling: touch;">
    <% recommendedJobs.forEach(job => { %>
   <div class="recommended-card flex flex-shrink-0 max-w-[300px] md:max-w-[400px] w-full snap-start flex-col [&>article]:flex-1 [&>article]:flex [&>article]:flex-col">
     <%- include('partials/jobItemCompact.ejs', { job, slugify, inSlider: true, fromRecommended: true }) %>
   </div>
 <% }) %>
</div>
  </section>
  <% } %>

  <!-- Top salary jobs (scrollable, hidden when any filter is active) -->
  <% if (topSalaryJobs && topSalaryJobs.length > 0) { %>
  <section id="top-salary-slider-section" class="w-full mx-auto px-4 mt-6 mb-4" style="<%= filtersActive ? 'display:none' : '' %>">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
      <div class="flex flex-col gap-1 flex-1">
        <h2 class="font-kolkha text-[18px] sm:text-[22px] text-[#151515]">
          ყველაზე მაღალანაზღაურებადი ვაკანსიები
        </h2>
        <% if (typeof topSalaryTotalCount !== 'undefined' && topSalaryTotalCount > 0) { %>
        <a href="/kvelaze-magalanazgaurebadi-vakansiebi" class="text-sm text-[#315EFF] hover:underline hidden sm:inline-block">
          ყველას ნახვა (<%= topSalaryTotalCount %>)
        </a>
        <% } %>
      </div>
      <div class="flex items-center justify-between sm:justify-end gap-2 flex-shrink-0">
        <% if (typeof topSalaryTotalCount !== 'undefined' && topSalaryTotalCount > 0) { %>
        <a href="/kvelaze-magalanazgaurebadi-vakansiebi" class="text-sm text-[#315EFF] hover:underline sm:hidden">
          ყველას ნახვა (<%= topSalaryTotalCount %>)
        </a>
        <% } %>
        <div class="flex items-center gap-2">
          <button type="button" class="top-salary-prev w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Prev">←</button>
          <button type="button" class="top-salary-next w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Next">→</button>
        </div>
      </div>
    </div>
    <div id="top-salary-scroll" class="top-salary-scroll flex w-full items-stretch gap-3 sm:gap-4 overflow-x-auto pb-4 pr-4 snap-x snap-mandatory" 
    style="scrollbar-width: none; -ms-overflow-style: none; -webkit-overflow-scrolling: touch;">
    <% topSalaryJobs.forEach(job => { %>
   <div class="top-salary-card flex flex-shrink-0 max-w-[300px] md:max-w-[400px] w-full snap-start flex-col [&>article]:flex-1 [&>article]:flex [&>article]:flex-col<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' premium-job-mobile-first' : '' %>"<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' data-premium="true"' : '' %>>
     <%- include('partials/jobItemCompact.ejs', { job, slugify, inSlider: true }) %>
   </div>
 <% }) %>
</div>
  </section>
  <% } %>

  <!-- Most popular jobs (ყველაზე ნახვადი ვაკანსიები) - hidden when any filter is active -->
  <% if (topPopularJobs && topPopularJobs.length > 0) { %>
  <section id="top-popular-slider-section" class="w-full mx-auto px-4 mt-6 mb-4" style="<%= filtersActive ? 'display:none' : '' %>">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
      <div class="flex flex-col gap-1 flex-1">
        <h2 class="font-kolkha text-[18px] sm:text-[22px] text-[#151515]">
          ყველაზე ნახვადი ვაკანსიები
        </h2>
        <% if (typeof topPopularTotalCount !== 'undefined' && topPopularTotalCount > 0) { %>
        <a href="/kvelaze-motkhovnadi-vakansiebi" class="text-sm text-[#315EFF] hover:underline hidden sm:inline-block">
          ყველას ნახვა (<%= topPopularTotalCount %>)
        </a>
        <% } %>
      </div>
      <div class="flex items-center justify-between sm:justify-end gap-2 flex-shrink-0">
        <% if (typeof topPopularTotalCount !== 'undefined' && topPopularTotalCount > 0) { %>
        <a href="/kvelaze-motkhovnadi-vakansiebi" class="text-sm text-[#315EFF] hover:underline sm:hidden">
          ყველას ნახვა (<%= topPopularTotalCount %>)
        </a>
        <% } %>
        <div class="flex items-center gap-2">
          <button type="button" class="top-popular-prev w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Prev">←</button>
          <button type="button" class="top-popular-next w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Next">→</button>
        </div>
      </div>
    </div>
    <div id="top-popular-scroll" class="top-popular-scroll flex w-full items-stretch gap-3 sm:gap-4 overflow-x-auto pb-4 pr-4 snap-x snap-mandatory" 
    style="scrollbar-width: none; -ms-overflow-style: none; -webkit-overflow-scrolling: touch;">
    <% topPopularJobs.forEach(job => { %>
   <div class="top-popular-card flex flex-shrink-0 max-w-[300px] md:max-w-[400px] w-full snap-start flex-col [&>article]:flex-1 [&>article]:flex [&>article]:flex-col<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' premium-job-mobile-first' : '' %>"<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' data-premium="true"' : '' %>>
     <%- include('partials/jobItemCompact.ejs', { job, slugify, inSlider: true }) %>
   </div>
 <% }) %>
</div>
  </section>
  <% } %>

  <div id="facebook-promo-main"><%- include('partials/facebookPromo') %></div>

  <!-- Today's jobs (დღევანდელი ვაკანსიები) - hidden when any filter is active -->
  <% if (todayJobs && todayJobs.length > 0 && !filtersActive) { %>
  <section id="today-jobs-section" class="w-full mx-auto px-4 mt-6 mb-4">
    <div class="flex items-center justify-between mb-4 gap-3">
      <div class="flex flex-col gap-1 flex-1">
        <h2 class="font-kolkha text-[18px] sm:text-[22px] text-[#151515]">
          დღევანდელი ვაკანსიები
        </h2>
        <% if (typeof todayJobsCount !== 'undefined' && todayJobsCount > 0) { %>
        <a href="/dgevandeli-vakansiebi" class="text-sm text-[#315EFF] hover:underline">
          ყველას ნახვა (<%= todayJobsCount %>)
        </a>
        <% } %>
      </div>
    </div>
    <div class="w-full mx-auto flex flex-col gap-0">
      <% todayJobs.slice(0, 10).forEach(job => { %>
      <%- include('partials/jobItem.ejs', { job, slugify }) %>
      <% }) %>
    </div>
  </section>
  <% } %>

  <!-- Jobs area (replaced without reload when filters change) -->
  <div id="jobs-area" data-current-page="<%= currentPage || 1 %>" data-total-pages="<%= totalPages || 1 %>">
  <% if (filtersActive) { %><%- include('partials/facebookPromo') %><% } %>
  <h1 id="all-vacancies-heading" class="font-kolkha text-[18px] sm:text-[22px] text-[#151515] flex-1 pb-4 w-full mx-auto px-4" style="<%= filtersActive ? 'display:none' : '' %>">
    <%= typeof pageType === 'string' && pageType === 'top-salary' ? 'ყველაზე მაღალანაზღაურებადი ვაკანსიები' : (typeof pageType === 'string' && pageType === 'top-views' ? 'ყველაზე ნახვადი ვაკანსიები' : (typeof pageType === 'string' && pageType === 'today' ? 'დღევანდელი ვაკანსიები' : (typeof pageType === 'string' && pageType === 'recommended' ? 'შენთვის რეკომენდებული ვაკანსიები' : (typeof pageType === 'string' && pageType === 'top-cv-fit' ? 'ვაკანსიები სადაც შენი CV ზუსტად ერგება' : 'ყველა ვაკანსია')))) %>
  </h1>
  <div class="w-full relative mx-auto px-4" id="jobs-container">
    <% if (jobs && jobs.length > 0) { %>
    <% jobs.forEach(job => { %>
    <%- include('partials/jobItem.ejs', { job, slugify, fromRecommended: typeof pageType !== 'undefined' && pageType === 'recommended', fromTopCvFit: typeof pageType !== 'undefined' && pageType === 'top-cv-fit' }) %>
    <% }) %>
    <% } %>
  </div>

  <!-- Loading indicator -->
  <div id="loading-indicator" class="flex justify-center" style="text-align: center; padding: 20px; color: #999; font-size: 14px; display: none;">
    იტვირთება...
  </div>
<!-- TOP.GE ASYNC COUNTER CODE -->
<div id="top-ge-counter-container" data-site-id="117980"></div>
<script async src="//counter.top.ge/counter.js"></script>
<!-- / END OF TOP.GE COUNTER CODE -->

  <% if (totalPages > 1) { %>
  <% const _paginationBase = (typeof paginationBase !== 'undefined' && paginationBase) ? paginationBase : '/'; %>
  <% const _pageUrl = _paginationBase + '?page='; %>
  <nav class="pagination pagination-small w-full flex justify-center items-center gap-2 py-4" style="display:none">
    <% if (currentPage > 1) { %>
    <a href="<%= _pageUrl %><%= currentPage - 1 %>" class="p-2 bg-primary text-white rounded-xl">← წინა</a>
    <% } %>

    <% 
    const maxVisible = 5;
    let startPage = Math.max(1, currentPage - 2);
    let endPage = Math.min(totalPages, currentPage + 2);
    
    if (startPage > 1) { %>
    <a href="<%= _pageUrl %>1" class="p-2 bg-primary text-white rounded-xl min-w-[30px] text-center">1</a>
    <% if (startPage > 2) { %><span>...</span><% } %>
    <% }
    
    for (let i = startPage; i <= endPage; i++) { %>
    <a href="<%= _pageUrl %><%= i %>" class="<%= i === currentPage ? 'active' : '' %> p-2 bg-primary text-white rounded-xl min-w-[30px] text-center"><%= i %></a>
    <% }
    
    if (endPage < totalPages) { 
      if (endPage < totalPages - 1) { %><span>...</span><% } %>
    <a href="<%= _pageUrl %><%= totalPages %>" class="p-2 bg-primary text-white rounded-xl min-w-[30px] text-center"><%= totalPages %></a>
    <% } %>

    <% if (currentPage < totalPages) { %>
    <a href="<%= _pageUrl %><%= currentPage + 1 %>" class="p-2 bg-primary text-white rounded-xl">შემდეგი →</a>
    <% } %>
  </nav>
  <% } %>
  </div>
  <script>
    const categoryNames = {
      '1': 'საოფისე',
      '2': 'მომხმარებელთან ურთიერთობები',
      '3': 'გაყიდვები',
      '4': 'საბანკო-საფინანსო',
      '5': 'საწყობი და წარმოება',
      '6': 'საცალო ვაჭრობა',
      '7': 'მზარეული',
      '8': 'აზარტული',
      '9': 'მენეჯმენტი',
      '10': 'ფარმაცია',
      '11': 'მიმტანი',
      '12': 'ინჟინერია',
      '13': 'ლოჯისტიკა',
      '14': 'სამედიცინო',
      '15': 'უსაფრთხოება',
      '16': 'დისტრიბუცია',
      '17': 'ინფორმაციული ტექნოლოგიები',
      '18': 'დიასახლისი',
      '19': 'სხვა',
      '20': 'ბუღალტერია',
      '21': 'მძღოლი',
      '22': 'Web/Digital/Design',
      '23': 'ექთანი',
      '24': 'ექიმი',
      '25': 'ადმინისტრატორი',
      '26': 'HR'
    };

    const container = document.getElementById('jobs-container');
    const jobsArea = document.getElementById('jobs-area');
    const loadingEl = document.getElementById('loading-indicator');
    const SCROLL_THRESHOLD = 400;
    let isLoadingMore = false;
    let scrollHandler = null;

    function trackPremiumPrioritizedClicks(link, section) {
      try {
        if (!window.amplitude) return;
        var props = {
          job_id: link.getAttribute('data-job-id'),
          job_category: categoryNames[link.getAttribute('data-job-category')] || link.getAttribute('data-job-category'),
          job_title: link.getAttribute('data-job-title'),
          company: link.getAttribute('data-job-company'),
          location: link.getAttribute('data-job-location'),
          section: section
        };
        if (link.getAttribute('data-premium') === 'true') window.amplitude.track('Premium Job Clicked', props);
        if (link.getAttribute('data-prioritize') === 'true') window.amplitude.track('Prioritized Job Clicked', props);
      } catch (e) {}
    }

    function bindNormalJobClicks(root) {
      try {
        if (!window.amplitude) return;
        const scope = root || document;
        const links = scope.querySelectorAll('#jobs-container a[data-job-id]');
        links.forEach(function (link) {
          if (link.__normalJobBound) return;
          link.__normalJobBound = true;
          link.addEventListener('click', function () {
            try {
              const categoryId = this.getAttribute('data-job-category');
              window.amplitude.track('Normal Job Clicked', {
                job_id: this.getAttribute('data-job-id'),
                job_category: categoryNames[categoryId] || categoryId,
                job_title: this.getAttribute('data-job-title'),
                salary_range: this.getAttribute('data-salary-range'),
                company: this.getAttribute('data-job-company'),
                location: this.getAttribute('data-job-location')
              });
              trackPremiumPrioritizedClicks(this, 'normal');
            } catch (e) {}
          });
        });
      } catch (e) {}
    }

    function loadMoreJobs() {
      const jobsAreaEl = document.getElementById('jobs-area');
      const containerEl = document.getElementById('jobs-container');
      if (!jobsAreaEl || !containerEl || isLoadingMore) return;
      const currentPage = parseInt(jobsAreaEl.dataset.currentPage || '1', 10);
      const totalPages = parseInt(jobsAreaEl.dataset.totalPages || '1', 10);
      if (currentPage >= totalPages) return;

      isLoadingMore = true;
      if (loadingEl) loadingEl.style.display = 'flex';

      const params = new URLSearchParams(window.location.search);
      params.set('page', currentPage + 1);
      params.set('append', '1');
      const base = (window.location.pathname || '/').replace(/\/$/, '') || '/';
      const url = base + (params.toString() ? '?' + params.toString() : '?append=1');

      fetch(url, { cache: 'no-store' })
        .then(function (res) { return res.text(); })
        .then(function (html) {
          var parser = new DOMParser();
          var doc = parser.parseFromString(html, 'text/html');
          var fetchedContainer = doc.getElementById('jobs-container');
          if (fetchedContainer) {
            var articles = fetchedContainer.querySelectorAll('article');
            articles.forEach(function (art) {
              containerEl.appendChild(art.cloneNode(true));
            });
            jobsAreaEl.dataset.currentPage = String(currentPage + 1);
            bindNormalJobClicks(containerEl);
          }
        })
        .catch(function (err) {
          console.error('Load more error:', err);
        })
        .finally(function () {
          isLoadingMore = false;
          if (loadingEl) loadingEl.style.display = 'none';
        });
    }

    function onScroll() {
      const jobsAreaEl = document.getElementById('jobs-area');
      if (!jobsAreaEl) return;
      const currentPage = parseInt(jobsAreaEl.dataset.currentPage || '1', 10);
      const totalPages = parseInt(jobsAreaEl.dataset.totalPages || '1', 10);
      if (isLoadingMore || currentPage >= totalPages) return;

      var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      var scrollHeight = document.documentElement.scrollHeight;
      var clientHeight = document.documentElement.clientHeight;
      if (scrollTop + clientHeight >= scrollHeight - SCROLL_THRESHOLD) {
        loadMoreJobs();
      }
    }

    function initLoadMore() {
      if (scrollHandler) {
        window.removeEventListener('scroll', scrollHandler);
      }
      scrollHandler = function () {
        requestAnimationFrame(onScroll);
      };
      window.addEventListener('scroll', scrollHandler, { passive: true });
    }

    function removeDuplicateJobs() {
      const containerEl = document.getElementById('jobs-container');
      if (!containerEl) return;
      const articles = containerEl.querySelectorAll('article[data-job-id]');
      const seen = new Set();
      articles.forEach(function(art) {
        const id = art.getAttribute('data-job-id');
        if (id && seen.has(id)) art.remove();
        else if (id) seen.add(id);
      });
    }

    removeDuplicateJobs();
    window.removeDuplicateJobs = removeDuplicateJobs;
    window.loadMoreJobs = loadMoreJobs;
    bindNormalJobClicks(container);
    initLoadMore();
    window.reinitLoadMore = initLoadMore;

    function loadPage(targetPage) {
      var params = new URLSearchParams(window.location.search);
      params.set('page', String(targetPage));
      params.delete('append');
      var base = (window.location.pathname || '/').replace(/\/$/, '') || '/';
      var url = base + (params.toString() ? '?' + params.toString() : '');
      return fetch(url, { cache: 'no-store' })
        .then(function (res) { return res.text(); })
        .then(function (html) {
          var parser = new DOMParser();
          var doc = parser.parseFromString(html, 'text/html');
          var fetchedJobsArea = doc.getElementById('jobs-area');
          var currentJobsArea = document.getElementById('jobs-area');
          if (fetchedJobsArea && currentJobsArea) {
            var fetchedContainer = doc.getElementById('jobs-container');
            var currentContainer = document.getElementById('jobs-container');
            if (fetchedContainer && currentContainer) {
              currentContainer.innerHTML = fetchedContainer.innerHTML;
            }
            currentJobsArea.dataset.currentPage = fetchedJobsArea.dataset.currentPage || '1';
            currentJobsArea.dataset.totalPages = fetchedJobsArea.dataset.totalPages || '1';
          }
          if (window.removeDuplicateJobs) window.removeDuplicateJobs();
          if (window.reinitLoadMore) window.reinitLoadMore();
          bindNormalJobClicks(container);
        });
    }
    window.loadPage = loadPage;

    window.addEventListener('load', function () {
      var savedY = sessionStorage.getItem(SCROLL_KEY);
      var savedPage = sessionStorage.getItem(PAGE_KEY);
      if (savedY !== null && savedPage !== null) {
        loadPage(parseInt(savedPage, 10)).then(function () {
          setTimeout(function () {
            window.scrollTo(0, parseInt(savedY, 10));
            sessionStorage.removeItem(SCROLL_KEY);
            sessionStorage.removeItem(PAGE_KEY);
          }, 100);
        });
      }
    });

    window.addEventListener('pageshow', function (e) {
      if (e.persisted) {
        var savedY = sessionStorage.getItem(SCROLL_KEY);
        if (savedY !== null) {
          setTimeout(function () { window.scrollTo(0, parseInt(savedY, 10)); }, 50);
          sessionStorage.removeItem(SCROLL_KEY);
          sessionStorage.removeItem(PAGE_KEY);
        }
      }
    });

    var scrollTimeout;
    window.addEventListener('scroll', function () {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(function () {
        var ja = document.getElementById('jobs-area');
        if (ja) {
          sessionStorage.setItem(SCROLL_KEY, String(window.scrollY));
          sessionStorage.setItem(PAGE_KEY, ja.dataset.currentPage || '1');
        }
      }, 250);
    }, { passive: true });

    document.addEventListener('click', function (e) {
      if (e.target.closest('a') || e.target.closest('form')) {
        var ja = document.getElementById('jobs-area');
        if (ja) {
          sessionStorage.setItem(SCROLL_KEY, String(window.scrollY));
          sessionStorage.setItem(PAGE_KEY, ja.dataset.currentPage || '1');
        }
      }
    }, true);

  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var scrollEl = document.getElementById('top-salary-scroll');
      var prevBtn = document.querySelector('.top-salary-prev');
      var nextBtn = document.querySelector('.top-salary-next');
      if (scrollEl && prevBtn) prevBtn.addEventListener('click', function () {
        scrollEl.scrollBy({ left: -320, behavior: 'smooth' });
      });
      if (scrollEl && nextBtn) nextBtn.addEventListener('click', function () {
        scrollEl.scrollBy({ left: 320, behavior: 'smooth' });
      });

      var popularScroll = document.getElementById('top-popular-scroll');
      var popularPrev = document.querySelector('.top-popular-prev');
      var popularNext = document.querySelector('.top-popular-next');
      if (popularScroll && popularPrev) popularPrev.addEventListener('click', function () {
        popularScroll.scrollBy({ left: -320, behavior: 'smooth' });
      });
      if (popularScroll && popularNext) popularNext.addEventListener('click', function () {
        popularScroll.scrollBy({ left: 320, behavior: 'smooth' });
      });

      var recommendedScroll = document.getElementById('recommended-scroll');
      var recommendedPrev = document.querySelector('.recommended-prev');
      var recommendedNext = document.querySelector('.recommended-next');
      if (recommendedScroll && recommendedPrev) recommendedPrev.addEventListener('click', function () {
        recommendedScroll.scrollBy({ left: -320, behavior: 'smooth' });
      });
      if (recommendedScroll && recommendedNext) recommendedNext.addEventListener('click', function () {
        recommendedScroll.scrollBy({ left: 320, behavior: 'smooth' });
      });

      var topCvFitScroll = document.getElementById('top-cv-fit-scroll');
      var topCvFitPrev = document.querySelector('.top-cv-fit-prev');
      var topCvFitNext = document.querySelector('.top-cv-fit-next');
      if (topCvFitScroll && topCvFitPrev) topCvFitPrev.addEventListener('click', function () {
        topCvFitScroll.scrollBy({ left: -320, behavior: 'smooth' });
      });
      if (topCvFitScroll && topCvFitNext) topCvFitNext.addEventListener('click', function () {
        topCvFitScroll.scrollBy({ left: 320, behavior: 'smooth' });
      });

      // Recommended: job click tracking
      const recommendedCards = document.querySelectorAll('.recommended-card a[data-job-id]');
      recommendedCards.forEach(function (card) {
        card.addEventListener('click', function () {
          try {
            if (window.amplitude) {
              const categoryId = this.getAttribute('data-job-category');
              window.amplitude.track('Recommended Job Clicked', {
                job_id: this.getAttribute('data-job-id'),
                job_category: categoryNames[categoryId] || categoryId,
                job_title: this.getAttribute('data-job-title'),
                salary_range: this.getAttribute('data-salary-range'),
                title: this.getAttribute('data-job-title'),
                company: this.getAttribute('data-job-company'),
                location: this.getAttribute('data-job-location')
              });
              trackPremiumPrioritizedClicks(this, 'recommended');
            }
          } catch (e) {}
        });
      });

      // Recommended: swipe/scroll tracking
      if (recommendedScroll) {
        var lastRecommendedScrollLeft = recommendedScroll.scrollLeft;
        var recommendedScrollTimeout;
        recommendedScroll.addEventListener('scroll', function () {
          clearTimeout(recommendedScrollTimeout);
          recommendedScrollTimeout = setTimeout(function () {
            var now = recommendedScroll.scrollLeft;
            if (now !== lastRecommendedScrollLeft && window.amplitude) {
              try {
                window.amplitude.track('Recommended Slider Swiped', {
                  direction: now > lastRecommendedScrollLeft ? 'left' : 'right'
                });
              } catch (e) {}
              lastRecommendedScrollLeft = now;
            }
          }, 150);
        });
      }

      // Recommended: "See all" click tracking
      const recommendedSeeAllLink = document.getElementById('recommended-see-all-link');
      if (recommendedSeeAllLink) {
        recommendedSeeAllLink.addEventListener('click', function () {
          try {
            if (window.amplitude) {
              window.amplitude.track('Recommended See All Clicked');
            }
          } catch (e) {}
        });
      }

      // Most popular: click tracking
      const popularCards = document.querySelectorAll('.top-popular-card a[data-job-id]');
      popularCards.forEach(function (card) {
        card.addEventListener('click', function () {
          try {
            if (window.amplitude) {
              const categoryId = this.getAttribute('data-job-category');
              window.amplitude.track('Most Popular Job Clicked', {
                job_id: this.getAttribute('data-job-id'),
                job_category: categoryNames[categoryId] || categoryId,
                job_title: this.getAttribute('data-job-title'),
                salary_range: this.getAttribute('data-salary-range'),
                title: this.getAttribute('data-job-title'),
                company: this.getAttribute('data-job-company'),
                location: this.getAttribute('data-job-location')
              });
              trackPremiumPrioritizedClicks(this, 'most_popular');
            }
          } catch (e) {}
        });
      });

      // Most popular: swipe/scroll tracking
      if (popularScroll) {
        var lastPopularScrollLeft = popularScroll.scrollLeft;
        var popularScrollTimeout;
        popularScroll.addEventListener('scroll', function () {
          clearTimeout(popularScrollTimeout);
          popularScrollTimeout = setTimeout(function () {
            var now = popularScroll.scrollLeft;
            if (now !== lastPopularScrollLeft && window.amplitude) {
              try {
                window.amplitude.track('Most Popular Slider Swiped', {
                  direction: now > lastPopularScrollLeft ? 'left' : 'right'
                });
              } catch (e) {}
              lastPopularScrollLeft = now;
            }
          }, 150);
        });
      }

      // Top CV fit: job click tracking
      const topCvFitCards = document.querySelectorAll('.top-cv-fit-card a[data-job-id]');
      topCvFitCards.forEach(function (card) {
        card.addEventListener('click', function () {
          try {
            if (window.amplitude) {
              const categoryId = this.getAttribute('data-job-category');
              window.amplitude.track('Top CV Fit Job Clicked', {
                job_id: this.getAttribute('data-job-id'),
                job_category: categoryNames[categoryId] || categoryId,
                job_title: this.getAttribute('data-job-title'),
                salary_range: this.getAttribute('data-salary-range'),
                title: this.getAttribute('data-job-title'),
                company: this.getAttribute('data-job-company'),
                location: this.getAttribute('data-job-location')
              });
              trackPremiumPrioritizedClicks(this, 'top_cv_fit');
            }
          } catch (e) {}
        });
      });

      // Top CV fit: swipe/scroll tracking
      if (topCvFitScroll) {
        var lastTopCvFitScrollLeft = topCvFitScroll.scrollLeft;
        var topCvFitScrollTimeout;
        topCvFitScroll.addEventListener('scroll', function () {
          clearTimeout(topCvFitScrollTimeout);
          topCvFitScrollTimeout = setTimeout(function () {
            var now = topCvFitScroll.scrollLeft;
            if (now !== lastTopCvFitScrollLeft && window.amplitude) {
              try {
                window.amplitude.track('Top CV Fit Slider Swiped', {
                  direction: now > lastTopCvFitScrollLeft ? 'left' : 'right'
                });
              } catch (e) {}
              lastTopCvFitScrollLeft = now;
            }
          }, 150);
        });
      }

      // Top CV fit: "See all" click tracking
      ['top-cv-fit-see-all-link', 'top-cv-fit-see-all-link-mobile'].forEach(function (id) {
        var el = document.getElementById(id);
        if (el) {
          el.addEventListener('click', function () {
            try {
              if (window.amplitude) window.amplitude.track('Top CV Fit See All Clicked');
            } catch (e) {}
          });
        }
      });

      const cards = document.querySelectorAll('.top-salary-card a[data-job-id]');
      cards.forEach(function (card) {
        card.addEventListener('click', function () {
          try {
            if (window.amplitude) {
              const categoryId = this.getAttribute('data-job-category');
              window.amplitude.track('Highest Paid Job Clicked', {
                job_id: this.getAttribute('data-job-id'),
                job_category: categoryNames[categoryId] || categoryId,
                job_title: this.getAttribute('data-job-title'),
                salary_range: this.getAttribute('data-salary-range'),
                title: this.getAttribute('data-job-title'),
                company: this.getAttribute('data-job-company'),
                location: this.getAttribute('data-job-location')
              });
              trackPremiumPrioritizedClicks(this, 'highest_paid');
            }
          } catch (e) {}
        });
      });
    });
  </script>
</body>

</html>