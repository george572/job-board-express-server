<!DOCTYPE html>
<html lang="ka">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <%- include('partials/head-meta', { seo }) %>
  <!-- WebSite schema for sitelinks / knowledge panel -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Samushao.ge",
      "url": "https://samushao.ge",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://samushao.ge/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
  </script>
  <!-- BreadcrumbList: მთავარი > ვაკანსიები -->
  <script type="application/ld+json">
    {"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"მთავარი","item":"https://samushao.ge/"},{"@type":"ListItem","position":2,"name":"ვაკანსიები","item":"<%= (seo && seo.canonical) ? seo.canonical : 'https://samushao.ge/' %>"}]}
  </script>
  <link rel="stylesheet" href="/css/style.css" />
  <% if (currentPage > 1) { %>
  <link rel="prev" href="https://samushao.ge/<%= currentPage === 2 ? '' : '?page=' + (currentPage - 1) %>">
  <% } %>
  <% if (currentPage < totalPages) { %>
  <link rel="next" href="https://samushao.ge/?page=<%= currentPage + 1 %>">
  <% } %>
</head>

<body class="font-markgeo text-secondary bg-[#F8F9FA]">
  <%- include('partials/gtm-noscript') %>
  <%- include('partials/header') %>
  <%- include('partials/filters') %>

  <!-- Form submission jobs (ვაკანსიები სადაც CV გარეშე მიგიღებენ) – FIRST for guests only, hidden when filters active -->
  <% if (!user && typeof formSubmissionJobs !== 'undefined' && formSubmissionJobs && formSubmissionJobs.length > 0) { %>
  <section id="form-submission-slider-section" class="w-full mx-auto px-4 mt-6 mb-4" style="<%= filtersActive ? 'display:none' : '' %>">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
      <div class="flex flex-col gap-1 flex-1">
        <h2 class="font-kolkha text-[18px] sm:text-[22px] text-[#151515]">ვაკანსიები სადაც CV გარეშე მიგიღებენ</h2>
        <% if (typeof formSubmissionTotalCount !== 'undefined' && formSubmissionTotalCount > 0) { %>
        <a href="/vakansiebi-cv-gareshe" class="text-sm text-[#315EFF] hover:underline hidden sm:inline-block">ყველას ნახვა (<%= formSubmissionTotalCount %>)</a>
        <% } %>
      </div>
      <div class="flex items-center justify-between sm:justify-end gap-2 flex-shrink-0">
        <% if (typeof formSubmissionTotalCount !== 'undefined' && formSubmissionTotalCount > 0) { %>
        <a href="/vakansiebi-cv-gareshe" class="text-sm text-[#315EFF] hover:underline sm:hidden">ყველას ნახვა (<%= formSubmissionTotalCount %>)</a>
        <% } %>
        <div class="flex items-center gap-2">
          <button type="button" class="form-submission-prev w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Prev">←</button>
          <button type="button" class="form-submission-next w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Next">→</button>
        </div>
      </div>
    </div>
    <div id="form-submission-scroll" class="form-submission-scroll flex w-full items-stretch gap-3 sm:gap-4 overflow-x-auto pb-4 pr-4 snap-x snap-mandatory" style="scrollbar-width: none; -ms-overflow-style: none; -webkit-overflow-scrolling: touch;">
      <% formSubmissionJobs.forEach(job => { %>
      <div class="form-submission-card flex flex-shrink-0 max-w-[300px] md:max-w-[400px] w-full snap-start flex-col [&>article]:flex-1 [&>article]:flex [&>article]:flex-col<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' premium-job-mobile-first' : '' %>"<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' data-premium="true"' : '' %>>
        <%- include('partials/jobItemCompact.ejs', { job, slugify, inSlider: true }) %>
      </div>
      <% }) %>
    </div>
  </section>
  <% } %>

  <!-- Top CV-fit jobs (ვაკანსიები სადაც შენი CV ზუსტად ერგება) – at top, slider, hidden when any filter is active -->
  <% if (typeof topCvFitJobs !== 'undefined' && topCvFitJobs && topCvFitJobs.length > 0) { %>
  <section id="top-cv-fit-slider-section" class="w-full mx-auto px-4 mt-6 mb-4" style="<%= filtersActive ? 'display:none' : '' %>">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
      <div class="flex flex-col gap-1 flex-1">
        <h2 class="font-kolkha text-[18px] sm:text-[22px] text-[#151515]">
          ვაკანსიები სადაც შენი CV ერგება
        </h2>
        <% if (typeof topCvFitTotalCount !== 'undefined' && topCvFitTotalCount > 0) { %>
        <a id="top-cv-fit-see-all-link" href="/vakansiebi-shentvis" class="text-sm text-[#315EFF] hover:underline hidden sm:inline-block">
          ყველას ნახვა (<%= topCvFitTotalCount %>)
        </a>
        <% } %>
      </div>
      <div class="flex items-center justify-between sm:justify-end gap-2 flex-shrink-0">
        <% if (typeof topCvFitTotalCount !== 'undefined' && topCvFitTotalCount > 0) { %>
        <a id="top-cv-fit-see-all-link-mobile" href="/vakansiebi-shentvis" class="text-sm text-[#315EFF] hover:underline sm:hidden">
          ყველას ნახვა (<%= topCvFitTotalCount %>)
        </a>
        <% } %>
        <div class="flex items-center gap-2">
          <button type="button" class="top-cv-fit-prev w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Prev">←</button>
          <button type="button" class="top-cv-fit-next w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Next">→</button>
        </div>
      </div>
    </div>
    <div id="top-cv-fit-scroll" class="top-cv-fit-scroll flex w-full items-stretch gap-3 sm:gap-4 overflow-x-auto pb-4 pr-4 snap-x snap-mandatory" 
    style="scrollbar-width: none; -ms-overflow-style: none; -webkit-overflow-scrolling: touch;">
    <% topCvFitJobs.forEach(job => { %>
   <div class="top-cv-fit-card flex flex-shrink-0 max-w-[300px] md:max-w-[400px] w-full snap-start flex-col [&>article]:flex-1 [&>article]:flex [&>article]:flex-col<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' premium-job-mobile-first' : '' %>"<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' data-premium="true"' : '' %>>
     <%- include('partials/jobItemCompact.ejs', { job, slugify, inSlider: true, fromTopCvFit: true }) %>
   </div>
 <% }) %>
</div>
  </section>
  <% } %>

  <!-- Form submission jobs (ვაკანსიები სადაც CV გარეშე მიგიღებენ) – for logged-in users, below top CV fit -->
  <% if (user && typeof formSubmissionJobs !== 'undefined' && formSubmissionJobs && formSubmissionJobs.length > 0) { %>
  <section id="form-submission-slider-section" class="w-full mx-auto px-4 mt-6 mb-4" style="<%= filtersActive ? 'display:none' : '' %>">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
      <div class="flex flex-col gap-1 flex-1">
        <h2 class="font-kolkha text-[18px] sm:text-[22px] text-[#151515]">ვაკანსიები სადაც CV გარეშე მიგიღებენ</h2>
        <% if (typeof formSubmissionTotalCount !== 'undefined' && formSubmissionTotalCount > 0) { %>
        <a href="/vakansiebi-cv-gareshe" class="text-sm text-[#315EFF] hover:underline hidden sm:inline-block">ყველას ნახვა (<%= formSubmissionTotalCount %>)</a>
        <% } %>
      </div>
      <div class="flex items-center justify-between sm:justify-end gap-2 flex-shrink-0">
        <% if (typeof formSubmissionTotalCount !== 'undefined' && formSubmissionTotalCount > 0) { %>
        <a href="/vakansiebi-cv-gareshe" class="text-sm text-[#315EFF] hover:underline sm:hidden">ყველას ნახვა (<%= formSubmissionTotalCount %>)</a>
        <% } %>
        <div class="flex items-center gap-2">
          <button type="button" class="form-submission-prev w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Prev">←</button>
          <button type="button" class="form-submission-next w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Next">→</button>
        </div>
      </div>
    </div>
    <div id="form-submission-scroll" class="form-submission-scroll flex w-full items-stretch gap-3 sm:gap-4 overflow-x-auto pb-4 pr-4 snap-x snap-mandatory" style="scrollbar-width: none; -ms-overflow-style: none; -webkit-overflow-scrolling: touch;">
      <% formSubmissionJobs.forEach(job => { %>
      <div class="form-submission-card flex flex-shrink-0 max-w-[300px] md:max-w-[400px] w-full snap-start flex-col [&>article]:flex-1 [&>article]:flex [&>article]:flex-col<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' premium-job-mobile-first' : '' %>"<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' data-premium="true"' : '' %>>
        <%- include('partials/jobItemCompact.ejs', { job, slugify, inSlider: true }) %>
      </div>
      <% }) %>
    </div>
  </section>
  <% } %>

  <!-- Recommended jobs (personalized – only when we have results) -->
  <% if (typeof recommendedJobs !== 'undefined' && recommendedJobs && recommendedJobs.length > 0) { %>
  <section id="recommended-jobs-section" class="w-full mx-auto px-4 mt-6 mb-4">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
      <div class="flex flex-col gap-1 flex-1">
        <h2 class="font-kolkha text-[18px] sm:text-[22px] text-[#151515]">
          მსგავს ვაკანსიებს ხშირად სტუმრობ
        </h2>
        <a id="recommended-see-all-link" href="/rekomendebuli-vakansiebi" class="text-sm text-[#315EFF] hover:underline">
          ყველას ნახვა
        </a>
      </div>
      <div class="flex items-center gap-2">
        <button type="button" class="recommended-prev w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Prev">←</button>
        <button type="button" class="recommended-next w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Next">→</button>
      </div>
    </div>
    <div id="recommended-scroll" class="recommended-scroll flex w-full items-stretch gap-3 sm:gap-4 overflow-x-auto pb-4 pr-4 snap-x snap-mandatory" 
    style="scrollbar-width: none; -ms-overflow-style: none; -webkit-overflow-scrolling: touch;">
    <% recommendedJobs.forEach(job => { %>
   <div class="recommended-card flex flex-shrink-0 max-w-[300px] md:max-w-[400px] w-full snap-start flex-col [&>article]:flex-1 [&>article]:flex [&>article]:flex-col">
     <%- include('partials/jobItemCompact.ejs', { job, slugify, inSlider: true, fromRecommended: true }) %>
   </div>
 <% }) %>
</div>
  </section>
  <% } %>

  <!-- Top salary jobs (scrollable, hidden when any filter is active) -->
  <% if (topSalaryJobs && topSalaryJobs.length > 0) { %>
  <section id="top-salary-slider-section" class="w-full mx-auto px-4 mt-6 mb-4" style="<%= filtersActive ? 'display:none' : '' %>">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
      <div class="flex flex-col gap-1 flex-1">
        <h2 class="font-kolkha text-[18px] sm:text-[22px] text-[#151515]">
          ყველაზე მაღალანაზღაურებადი ვაკანსიები
        </h2>
        <% if (typeof topSalaryTotalCount !== 'undefined' && topSalaryTotalCount > 0) { %>
        <a href="/kvelaze-magalanazgaurebadi-vakansiebi" class="text-sm text-[#315EFF] hover:underline hidden sm:inline-block">
          ყველას ნახვა (<%= topSalaryTotalCount %>)
        </a>
        <% } %>
      </div>
      <div class="flex items-center justify-between sm:justify-end gap-2 flex-shrink-0">
        <% if (typeof topSalaryTotalCount !== 'undefined' && topSalaryTotalCount > 0) { %>
        <a href="/kvelaze-magalanazgaurebadi-vakansiebi" class="text-sm text-[#315EFF] hover:underline sm:hidden">
          ყველას ნახვა (<%= topSalaryTotalCount %>)
        </a>
        <% } %>
        <div class="flex items-center gap-2">
          <button type="button" class="top-salary-prev w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Prev">←</button>
          <button type="button" class="top-salary-next w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Next">→</button>
        </div>
      </div>
    </div>
    <div id="top-salary-scroll" class="top-salary-scroll flex w-full items-stretch gap-3 sm:gap-4 overflow-x-auto pb-4 pr-4 snap-x snap-mandatory" 
    style="scrollbar-width: none; -ms-overflow-style: none; -webkit-overflow-scrolling: touch;">
    <% topSalaryJobs.forEach(job => { %>
   <div class="top-salary-card flex flex-shrink-0 max-w-[300px] md:max-w-[400px] w-full snap-start flex-col [&>article]:flex-1 [&>article]:flex [&>article]:flex-col<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' premium-job-mobile-first' : '' %>"<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' data-premium="true"' : '' %>>
     <%- include('partials/jobItemCompact.ejs', { job, slugify, inSlider: true }) %>
   </div>
 <% }) %>
</div>
  </section>
  <% } %>

  <!-- Most popular jobs (ყველაზე ნახვადი ვაკანსიები) - hidden when any filter is active -->
  <% if (topPopularJobs && topPopularJobs.length > 0) { %>
  <section id="top-popular-slider-section" class="w-full mx-auto px-4 mt-6 mb-4" style="<%= filtersActive ? 'display:none' : '' %>">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
      <div class="flex flex-col gap-1 flex-1">
        <h2 class="font-kolkha text-[18px] sm:text-[22px] text-[#151515]">
          ყველაზე ნახვადი ვაკანსიები
        </h2>
        <% if (typeof topPopularTotalCount !== 'undefined' && topPopularTotalCount > 0) { %>
        <a href="/kvelaze-motkhovnadi-vakansiebi" class="text-sm text-[#315EFF] hover:underline hidden sm:inline-block">
          ყველას ნახვა (<%= topPopularTotalCount %>)
        </a>
        <% } %>
      </div>
      <div class="flex items-center justify-between sm:justify-end gap-2 flex-shrink-0">
        <% if (typeof topPopularTotalCount !== 'undefined' && topPopularTotalCount > 0) { %>
        <a href="/kvelaze-motkhovnadi-vakansiebi" class="text-sm text-[#315EFF] hover:underline sm:hidden">
          ყველას ნახვა (<%= topPopularTotalCount %>)
        </a>
        <% } %>
        <div class="flex items-center gap-2">
          <button type="button" class="top-popular-prev w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Prev">←</button>
          <button type="button" class="top-popular-next w-8 h-8 sm:w-10 sm:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center hover:bg-[#F5F8FF] text-sm sm:text-base cursor-pointer" aria-label="Next">→</button>
        </div>
      </div>
    </div>
    <div id="top-popular-scroll" class="top-popular-scroll flex w-full items-stretch gap-3 sm:gap-4 overflow-x-auto pb-4 pr-4 snap-x snap-mandatory" 
    style="scrollbar-width: none; -ms-overflow-style: none; -webkit-overflow-scrolling: touch;">
    <% topPopularJobs.forEach(job => { %>
   <div class="top-popular-card flex flex-shrink-0 max-w-[300px] md:max-w-[400px] w-full snap-start flex-col [&>article]:flex-1 [&>article]:flex [&>article]:flex-col<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' premium-job-mobile-first' : '' %>"<%= (job.job_premium_status === 'premium' || job.job_premium_status === 'premiumPlus') ? ' data-premium="true"' : '' %>>
     <%- include('partials/jobItemCompact.ejs', { job, slugify, inSlider: true }) %>
   </div>
 <% }) %>
</div>
  </section>
  <% } %>

  <div id="facebook-promo-main"><%- include('partials/facebookPromo') %></div>

  <!-- Today's jobs (დღევანდელი ვაკანსიები) - hidden when any filter is active. Lazy-loaded when deferBelowFold. -->
  <% if (typeof deferBelowFold !== 'undefined' && deferBelowFold && !filtersActive) { %>
  <div id="lazy-today-placeholder" class="lazy-section-placeholder w-full mx-auto px-4 mt-6 mb-4 min-h-[120px] flex items-center justify-center" data-lazy-section="today" data-lazy-loaded="false">
    <div class="text-gray-400 text-sm">იტვირთება...</div>
  </div>
  <% } else if (todayJobs && todayJobs.length > 0 && !filtersActive) { %>
  <section id="today-jobs-section" class="w-full mx-auto px-4 mt-6 mb-4">
    <div class="flex items-center justify-between mb-4 gap-3">
      <div class="flex flex-col gap-1 flex-1">
        <h2 class="font-kolkha text-[18px] sm:text-[22px] text-[#151515]">
          დღევანდელი ვაკანსიები
        </h2>
        <% if (typeof todayJobsCount !== 'undefined' && todayJobsCount > 0) { %>
        <a href="/dgevandeli-vakansiebi" class="text-sm text-[#315EFF] hover:underline">
          ყველას ნახვა (<%= todayJobsCount %>)
        </a>
        <% } %>
      </div>
    </div>
    <div class="w-full mx-auto flex flex-col gap-0">
      <% todayJobs.slice(0, 5).forEach(job => { %>
      <%- include('partials/jobItem.ejs', { job, slugify }) %>
      <% }) %>
    </div>
  </section>
  <% } %>

  <!-- Jobs area (replaced without reload when filters change) -->
  <div id="jobs-area" data-current-page="<%= currentPage || 1 %>" data-total-pages="<%= totalPages || 1 %>">
  <% if (filtersActive) { %><%- include('partials/facebookPromo') %><% } %>
  <h1 id="all-vacancies-heading" class="font-kolkha text-[18px] sm:text-[22px] text-[#151515] flex-1 pb-4 w-full mx-auto px-4" style="<%= filtersActive ? 'display:none' : '' %>">
    <%= typeof pageType === 'string' && pageType === 'top-salary' ? 'ყველაზე მაღალანაზღაურებადი ვაკანსიები' : (typeof pageType === 'string' && pageType === 'top-views' ? 'ყველაზე ნახვადი ვაკანსიები' : (typeof pageType === 'string' && pageType === 'today' ? 'დღევანდელი ვაკანსიები' : (typeof pageType === 'string' && pageType === 'recommended' ? 'შენთვის რეკომენდებული ვაკანსიები' : (typeof pageType === 'string' && pageType === 'top-cv-fit' ? 'ვაკანსიები სადაც შენი CV ერგება' : (typeof pageType === 'string' && pageType === 'form-submission' ? 'ვაკანსიები სადაც CV გარეშე მიგიღებენ' : 'ყველა ვაკანსია'))))) %>
  </h1>
  <div class="w-full relative mx-auto px-4" id="jobs-container">
    <% if (jobs && jobs.length > 0) { %>
    <% jobs.forEach(job => { %>
    <%- include('partials/jobItem.ejs', { job, slugify, fromRecommended: typeof pageType !== 'undefined' && pageType === 'recommended', fromTopCvFit: typeof pageType !== 'undefined' && pageType === 'top-cv-fit' }) %>
    <% }) %>
    <% } %>
  </div>

  <!-- Loading indicator -->
  <div id="loading-indicator" class="flex justify-center" style="text-align: center; padding: 20px; color: #999; font-size: 14px; display: none;">
    იტვირთება...
  </div>
<!-- TOP.GE ASYNC COUNTER CODE -->
<div id="top-ge-counter-container" data-site-id="117980"></div>
<script async src="//counter.top.ge/counter.js"></script>
<!-- / END OF TOP.GE COUNTER CODE -->

  <% if (totalPages > 1) { %>
  <% const _paginationBase = (typeof paginationBase !== 'undefined' && paginationBase) ? paginationBase : '/'; %>
  <% const _pageUrl = _paginationBase + '?page='; %>
  <nav class="pagination pagination-small w-full flex justify-center items-center gap-2 py-4" style="display:none">
    <% if (currentPage > 1) { %>
    <a href="<%= _pageUrl %><%= currentPage - 1 %>" class="p-2 bg-primary text-white rounded-xl">← წინა</a>
    <% } %>

    <% 
    const maxVisible = 5;
    let startPage = Math.max(1, currentPage - 2);
    let endPage = Math.min(totalPages, currentPage + 2);
    
    if (startPage > 1) { %>
    <a href="<%= _pageUrl %>1" class="p-2 bg-primary text-white rounded-xl min-w-[30px] text-center">1</a>
    <% if (startPage > 2) { %><span>...</span><% } %>
    <% }
    
    for (let i = startPage; i <= endPage; i++) { %>
    <a href="<%= _pageUrl %><%= i %>" class="<%= i === currentPage ? 'active' : '' %> p-2 bg-primary text-white rounded-xl min-w-[30px] text-center"><%= i %></a>
    <% }
    
    if (endPage < totalPages) { 
      if (endPage < totalPages - 1) { %><span>...</span><% } %>
    <a href="<%= _pageUrl %><%= totalPages %>" class="p-2 bg-primary text-white rounded-xl min-w-[30px] text-center"><%= totalPages %></a>
    <% } %>

    <% if (currentPage < totalPages) { %>
    <a href="<%= _pageUrl %><%= currentPage + 1 %>" class="p-2 bg-primary text-white rounded-xl">შემდეგი →</a>
    <% } %>
  </nav>
  <% } %>
  </div>
  <script>
  // ─── LOAD-MORE & JOB TRACKING ───────────────────────────────────────────

  const categoryNames = {
    '1':'საოფისე','2':'მომხმარებელთან ურთიერთობები','3':'გაყიდვები',
    '4':'საბანკო-საფინანსო','5':'საწყობი და წარმოება','6':'საცალო ვაჭრობა',
    '7':'მზარეული','8':'აზარტული','9':'მენეჯმენტი','10':'ფარმაცია',
    '11':'მიმტანი','12':'ინჟინერია','13':'ლოჯისტიკა','14':'სამედიცინო',
    '15':'უსაფრთხოება','16':'დისტრიბუცია','17':'ინფორმაციული ტექნოლოგიები',
    '18':'დიასახლისი','19':'სხვა','20':'ბუღალტერია','21':'მძღოლი',
    '22':'Web/Digital/Design','23':'ექთანი','24':'ექიმი',
    '25':'ადმინისტრატორი','26':'HR'
  };

  window._isLoadingMore = false;

  function trackPremiumPrioritizedClicks(link, section) {
    try {
      if (!window.amplitude) return;
      var props = {
        job_id: link.getAttribute('data-job-id'),
        job_category: categoryNames[link.getAttribute('data-job-category')] || link.getAttribute('data-job-category'),
        job_title: link.getAttribute('data-job-title'),
        company: link.getAttribute('data-job-company'),
        location: link.getAttribute('data-job-location'),
        section: section
      };
      if (link.getAttribute('data-premium') === 'true') window.amplitude.track('Premium Job Clicked', props);
      if (link.getAttribute('data-prioritize') === 'true') window.amplitude.track('Prioritized Job Clicked', props);
    } catch(e) {}
  }

  function bindNormalJobClicks(root) {
    try {
      if (!window.amplitude) return;
      var links = (root || document).querySelectorAll('#jobs-container a[data-job-id]');
      links.forEach(function(link) {
        if (link.__normalJobBound) return;
        link.__normalJobBound = true;
        link.addEventListener('click', function() {
          try {
            var cid = this.getAttribute('data-job-category');
            window.amplitude.track('Normal Job Clicked', {
              job_id: this.getAttribute('data-job-id'),
              job_category: categoryNames[cid] || cid,
              job_title: this.getAttribute('data-job-title'),
              salary_range: this.getAttribute('data-salary-range'),
              company: this.getAttribute('data-job-company'),
              location: this.getAttribute('data-job-location')
            });
            trackPremiumPrioritizedClicks(this, 'normal');
          } catch(e) {}
        });
      });
    } catch(e) {}
  }

  function removeDuplicateJobs() {
    var c = document.getElementById('jobs-container');
    if (!c) return;
    var seen = new Set();
    c.querySelectorAll('article[data-job-id]').forEach(function(a) {
      var id = a.getAttribute('data-job-id');
      if (id && seen.has(id)) a.remove(); else if (id) seen.add(id);
    });
  }

  function loadMoreJobs() {
    var jobsAreaEl = document.getElementById('jobs-area');
    var containerEl = document.getElementById('jobs-container');
    var loadingEl = document.getElementById('loading-indicator');
    if (!jobsAreaEl || !containerEl || window._isLoadingMore) return;
    var cur = parseInt(jobsAreaEl.dataset.currentPage || '1', 10);
    var tot = parseInt(jobsAreaEl.dataset.totalPages || '1', 10);
    if (cur >= tot) return;

    window._isLoadingMore = true;
    if (loadingEl) loadingEl.style.display = 'flex';

    var params = new URLSearchParams(window.location.search);
    params.set('page', cur + 1);
    params.set('append', '1');
    var base = (window.location.pathname || '/').replace(/\/$/, '') || '/';
    fetch(base + '?' + params.toString(), { cache: 'no-store' })
      .then(function(r) { return r.text(); })
      .then(function(html) {
        var doc = new DOMParser().parseFromString(html, 'text/html');
        var fc = doc.getElementById('jobs-container');
        if (fc) {
          fc.querySelectorAll('article').forEach(function(a) {
            containerEl.appendChild(a.cloneNode(true));
          });
          jobsAreaEl.dataset.currentPage = String(cur + 1);
          bindNormalJobClicks(containerEl);
        }
      })
      .catch(function(e) { console.error('Load more:', e); })
      .finally(function() {
        window._isLoadingMore = false;
        if (loadingEl) loadingEl.style.display = 'none';
      });
  }

  function loadPage(targetPage, htmlPromise) {
    var params = new URLSearchParams(window.location.search);
    params.set('page', String(targetPage));
    params.delete('append');
    var base = (window.location.pathname || '/').replace(/\/$/, '') || '/';
    var url = base + (params.toString() ? '?' + params.toString() : '');
    return (htmlPromise || fetch(url, { cache: 'no-store' }).then(function(r) { return r.text(); }))
      .then(function(html) {
        var doc = new DOMParser().parseFromString(html, 'text/html');
        var fc = doc.getElementById('jobs-container');
        var jc = document.getElementById('jobs-container');
        var ja = document.getElementById('jobs-area');
        var meta = doc.getElementById('jobs-area-meta') || doc.getElementById('jobs-area');
        if (fc && jc) jc.innerHTML = fc.innerHTML;
        if (meta && ja) {
          ja.dataset.currentPage = meta.getAttribute('data-current-page') || meta.dataset.currentPage || '1';
          ja.dataset.totalPages = meta.getAttribute('data-total-pages') || meta.dataset.totalPages || '1';
        }
        removeDuplicateJobs();
        bindNormalJobClicks(jc);
        setupScrollListener();
      });
  }

  // ─── SCROLL LISTENER — only ONE, ever ───────────────────────────────────
  function onScroll() {
    var ja = document.getElementById('jobs-area');
    if (!ja || window._isLoadingMore) return;
    var cur = parseInt(ja.dataset.currentPage || '1', 10);
    var tot = parseInt(ja.dataset.totalPages || '1', 10);
    if (cur >= tot) return;
    if (window.pageYOffset + window.innerHeight >= document.documentElement.scrollHeight - 400) {
      loadMoreJobs();
    }
  }

  function setupScrollListener() {
    if (window.__scrollRaf) cancelAnimationFrame(window.__scrollRaf);
    if (window.__scrollFn) window.removeEventListener('scroll', window.__scrollFn);
    window.__scrollFn = function() {
      if (window.__scrollRaf) cancelAnimationFrame(window.__scrollRaf);
      window.__scrollRaf = requestAnimationFrame(onScroll);
    };
    window.addEventListener('scroll', window.__scrollFn, { passive: true });
  }

  // ─── LAZY SECTIONS ───────────────────────────────────────────────────────
  function initLazySections() {
    var sections = document.querySelectorAll('[data-lazy-section][data-lazy-loaded="false"]');
    if (!sections.length) return;
    var io = window.IntersectionObserver ? new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (!entry.isIntersecting) return;
        var el = entry.target;
        io.unobserve(el);
        loadSection(el);
      });
    }, { rootMargin: '200px 0px', threshold: 0.01 }) : null;
    sections.forEach(function(el) { io ? io.observe(el) : loadSection(el); });
  }

  function loadSection(el) {
    var section = el.getAttribute('data-lazy-section');
    if (!section || el.getAttribute('data-lazy-loaded') === 'true') return;
    el.setAttribute('data-lazy-loaded', 'true');
    var params = new URLSearchParams(window.location.search);
    params.set('section', section);
    if (section === 'main') params.set('page', '1');
    fetch('/api/home/section?' + params.toString(), { cache: 'no-store' })
      .then(function(r) { return r.text(); })
      .then(function(html) {
        if (section === 'today') {
          var wrap = document.createElement('div');
          wrap.innerHTML = html.trim();
          if (wrap.firstChild && el.parentNode) el.parentNode.replaceChild(wrap.firstChild, el);
        } else if (section === 'main') {
          var ja = document.getElementById('jobs-area');
          if (!ja) return;
          ja.innerHTML = html;
          var meta = ja.querySelector('#jobs-area-meta');
          if (meta) {
            ja.dataset.currentPage = meta.getAttribute('data-current-page') || '1';
            ja.dataset.totalPages = meta.getAttribute('data-total-pages') || '1';
          }
          bindNormalJobClicks(document.getElementById('jobs-container'));
          removeDuplicateJobs();
          setupScrollListener();
        }
      })
      .catch(function() { el.setAttribute('data-lazy-loaded', 'false'); });
  }

  // ─── SLIDERS ─────────────────────────────────────────────────────────────
  function bindSlider(scrollId, prevSel, nextSel) {
    var scroll = document.getElementById(scrollId);
    if (!scroll) return;
    [prevSel, nextSel].forEach(function(sel, i) {
      document.querySelectorAll(sel).forEach(function(btn) {
        var clone = btn.cloneNode(true);
        btn.parentNode.replaceChild(clone, btn);
        clone.addEventListener('click', function() {
          scroll.scrollBy({ left: i === 0 ? -320 : 320, behavior: 'smooth' });
        });
      });
    });
  }

  function initSliders() {
    bindSlider('top-salary-scroll',      '.top-salary-prev',      '.top-salary-next');
    bindSlider('top-popular-scroll',     '.top-popular-prev',     '.top-popular-next');
    bindSlider('form-submission-scroll', '.form-submission-prev', '.form-submission-next');
    bindSlider('recommended-scroll',     '.recommended-prev',     '.recommended-next');
    bindSlider('top-cv-fit-scroll',      '.top-cv-fit-prev',      '.top-cv-fit-next');
  }

  // ─── AMPLITUDE TRACKING ──────────────────────────────────────────────────
  function initTracking() {
    function trackSliderJob(selector, eventName, section) {
      document.querySelectorAll(selector + ' a[data-job-id]').forEach(function(card) {
        if (card.__sliderBound) return;
        card.__sliderBound = true;
        card.addEventListener('click', function() {
          try {
            if (!window.amplitude) return;
            var cid = this.getAttribute('data-job-category');
            window.amplitude.track(eventName, {
              job_id: this.getAttribute('data-job-id'),
              job_category: categoryNames[cid] || cid,
              job_title: this.getAttribute('data-job-title'),
              salary_range: this.getAttribute('data-salary-range'),
              company: this.getAttribute('data-job-company'),
              location: this.getAttribute('data-job-location')
            });
            trackPremiumPrioritizedClicks(this, section);
          } catch(e) {}
        });
      });
    }
    trackSliderJob('.recommended-card',     'Recommended Job Clicked',               'recommended');
    trackSliderJob('.top-popular-card',     'Most Popular Job Clicked',              'most_popular');
    trackSliderJob('.top-cv-fit-card',      'Top CV Fit Job Clicked',                'top_cv_fit');
    trackSliderJob('.top-salary-card',      'Highest Paid Job Clicked',              'highest_paid');
    trackSliderJob('.form-submission-card', 'Jobs Without CV Requirement Job Clicked','jobs_without_cv_requirement');

    var rAll = document.getElementById('recommended-see-all-link');
    if (rAll && !rAll.__seeAllBound) {
      rAll.__seeAllBound = true;
      rAll.addEventListener('click', function() {
        try { if (window.amplitude) window.amplitude.track('Recommended See All Clicked'); } catch(e) {}
      });
    }
    ['top-cv-fit-see-all-link','top-cv-fit-see-all-link-mobile'].forEach(function(id) {
      var el = document.getElementById(id);
      if (el && !el.__seeAllBound) {
        el.__seeAllBound = true;
        el.addEventListener('click', function() {
          try { if (window.amplitude) window.amplitude.track('Top CV Fit See All Clicked'); } catch(e) {}
        });
      }
    });
  }

  // ─── MAIN PAGE INIT — runs once per page, guaranteed ─────────────────────
  function pageInit() {
    removeDuplicateJobs();
    bindNormalJobClicks(document.getElementById('jobs-container'));
    setupScrollListener();
    initLazySections();
    initSliders();
    initTracking();
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', pageInit);
  } else {
    pageInit();
  }

  window.loadMoreJobs = loadMoreJobs;
  window.loadPage = loadPage;
  window.removeDuplicateJobs = removeDuplicateJobs;
  window.reinitLoadMore = setupScrollListener;
</script>
</body>

</html>